<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Title</title>
	</head>
	<body>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			.wrapper {
				margin: 0 auto;
				padding: 20px;
				max-width: 500px;
				width: 100%;
			}
			#key, #text {
				margin-bottom: 15px;
				padding: 10px 20px;
				display: block;
				width: 100%;
			}
			#button {
				padding: 10px;
				width: 100%;
				text-transform: uppercase;
				background-color: transparent;
				border: 1px solid black;
				cursor: pointer;
			}
			#output {
				padding: 20px 0;
			}
		</style>

		<div class="wrapper">
			<input type="text" id="key" placeholder="Keyword">
		
			<textarea name="" id="text" cols="30" rows="10" placeholder="Enter text"></textarea>
		
			<button id="button">Action</button>

			<div id="output"></div>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

		<script>
			var key = getById('key');
			var text = getById('text')
			var button = getById('button');
			var output = getById('output');

			button.addEventListener('click', function() {
				output.innerHTML = encode(key.value, text.value);
			});

			function encode(key, text) {
				var arrayHeight = Math.ceil(text.length / key.length);
				var count = 0;

				var keyArray = [];
				var keyArrayForSort = [];
				var sortResult = [];
				var array = [];

				var result = [];

				for (var i = 0; i < key.length; i++) {
					keyArray.push(key[i].charCodeAt());
					keyArrayForSort.push(key[i].charCodeAt());
				}

				keyArrayForSort.sort(function(a, b) {
					return a - b;
				});

				for (var i = 0; i < keyArrayForSort.length; i++) {
					sortResult.push(keyArray.indexOf(keyArrayForSort[i]));
				}


				for (var i = 0; i < arrayHeight; i++) {
					array.push([]);
					for (var j = 0; j < key.length; j++) {
						if (text[count]) {
							array[i].push(text[count]);
						} else {
							array[i].push(' ');
						}

						count++;
					}
				}

				for (var i = 0; i < array.length; i++) {
					for (var j = 0; j < array[i].length; j++) {

						// debugger;
						if (array[i][sortResult[j]] == ' ') {
							result.push('_')
						} else {
							result.push(array[i][sortResult[j]]);
						}
					}
				}

				return result.join('');
			}

			// function encodeText2(key, text){
			// 	for(var i = 0; i < text.length % key.length; i++){
			// 		text += '_'
			// 	}

			// 	var arr = key.split('');
			// 	var arrSort = arr.sort();
			// 	var obj = {};

			// 	for(var i = 0; i < arr.length; i++){
			// 		obj[arr[i]] = arrSort.indexOf(arr[i]);
			// 	}

			// 	var regex = new RegExp('(.{' + key.length + '}|.|\\s)', "g");
			// 	var tArr = text.match(regex);
			// 	var result = '';

			// 	for(var i = 0; i < tArr.length; i++){
			// 		for(var j = 0; j < tArr[i].length; j++){
			// 			result += tArr[i][obj[key[j]]];
			// 		}
			// 	}

			// 	return result;
			// }

			function getById(id) {
			    return document.getElementById(id);
			}
		</script>
	</body>
</html>