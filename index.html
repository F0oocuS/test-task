<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Title</title>
	</head>
	<body>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			.wrapper {
				margin: 0 auto;
				padding: 20px;
				max-width: 500px;
				width: 100%;
			}
			#key, #text {
				margin-bottom: 15px;
				padding: 10px 20px;
				display: block;
				width: 100%;
			}
			#button {
				padding: 10px;
				width: 100%;
				text-transform: uppercase;
				background-color: transparent;
				border: 1px solid black;
				cursor: pointer;
			}
			#output {
				padding: 20px 0;
			}
		</style>

		<div class="wrapper">
			<input type="text" id="key" placeholder="Keyword">
		
			<textarea name="" id="text" cols="30" rows="10" placeholder="Enter text"></textarea>
		
			<button id="button">Action</button>

			<div id="output"></div>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

		<script>
			var key = getById('key');
			var text = getById('text')
			var button = getById('button');
			var output = getById('output');


			button.addEventListener('click', function() {

				output.innerHTML = encodeText2(key.value, text.value);
				/*var a = Math.ceil(text.value.length / key.value.length)
				var count = 0;

				var array = [];
				var keyArray = [];
				var sortArray = [];
				var sortRules = [];

				for (var i = 0; i < key.value.length; i++) {
					keyArray.push(key.value[i].charCodeAt());
				}

				sortArray.push(keyArray.sort(function(a, b) {
					return a - b;
				}));

				for (var i = 0; i < keyArray.length; i++) {
					sortRules.push(keyArray.indexOf(sortArray[i]));
				}

				console.log(sortRules);


				for (var i = 0; i < a; i++) {
					array.push([]);
					for (var j = 0; j < key.value.length; j++) {
						if (text.value[count]) {
							array[i].push(text.value[count]);
						} else {
							array[i].push(' ');
						}

						count++;
					}
				}

				console.log(array);*/
			});

			function encodeText2(key, text){
				for(var i = 0; i < text.length % key.length; i++){
					text += '_'
				}

				var arr = key.split('');
				var arrSort = arr.sort();
				var obj = {};

				for(var i = 0; i < arr.length; i++){
					obj[arr[i]] = arrSort.indexOf(arr[i]);
				}

				var regex = new RegExp('(.{' + key.length + '}|.|\\s)', "g");
				var tArr = text.match(regex);
				var result = '';

				for(var i = 0; i < tArr.length; i++){
					for(var j = 0; j < tArr[i].length; j++){
						result += tArr[i][obj[key[j]]];
					}
				}

				return result;
			}

			function getById(id) {
			    return document.getElementById(id);
			}
		</script>
	</body>
</html>